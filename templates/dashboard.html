<!DOCTYPE html>
<html>
<head>
    <title>Migration Game Dashboard</title>
    <style>
        body { font-family: Arial; max-width: 1000px; margin: auto; padding: 20px; }
        h1 { text-align: center; }
        nav a { margin-right: 20px; }
        .card { padding: 10px 15px; border: 1px solid #ccc; border-radius: 8px; margin: 10px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 8px; font-size: 14px; }
        th { background: #f2f2f2; }
        .correct { color: green; font-weight: bold; }
        .incorrect { color: red; font-weight: bold; }
        form.inline { display: inline-block; margin-right: 15px; }
        .navbar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .nav-btn {
            padding: 10px 18px;
            background: #093a6e;
            color: white;
            font-weight: bold;
            border-radius: 8px;
            text-decoration: none;
            transition: background 0.3s ease, transform 0.2s ease;
        }

        .nav-btn:hover {
            background: #3586dc;
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: #3586dc;
            border: 2px solid white;
        }

        /* =======================
   MOBILE OPTIMIZATION
   ======================= */
    @media (max-width: 600px) {
    
        body {
            max-width: 100%;
            padding: 12px;
            font-size: 16px;
        }
    
        h1, h2, h3 {
            font-size: 22px;
            text-align: center;
        }
    
        /* Navbar becomes stacked */
        .navbar {
            flex-direction: column;
            gap: 10px;
        }
    
        .nav-btn {
            width: 100%;
            font-size: 16px;
            padding: 12px;
            text-align: center;
        }
    
        /* Make buttons full width and bigger tap targets */
        button, .submit-btn {
            width: 100%;
            padding: 14px;
            font-size: 18px;
            margin-top: 10px;
        }
    
        /* Radio labels fixed for readability */
        label {
            font-size: 18px;
            display: block;
            padding: 6px 0;
        }
    
        /* Tables become scrollable instead of broken */
        table {
            font-size: 14px;
            display: block;
            overflow-x: auto;
            white-space: nowrap;
        }
    
        th, td {
            padding: 6px;
        }
    
        /* Cards get slightly larger spacing */
        .card {
            padding: 15px;
        }
    
        /* Small success text tweaks */
        .success {
            font-size: 18px;
        }
    }


    </style>
</head>
<body>

<nav class="navbar">
  <a href="/log" class="nav-btn {% if request.path == '/log' %}active{% endif %}">Log Data</a>
  <a href="/dashboard" class="nav-btn {% if request.path == '/dashboard' %}active{% endif %}">Dashboard</a>
  <a href="/export/csv" class="nav-btn">Download CSV</a>
  <a href="/export/excel" class="nav-btn">Download Excel</a>
  <a href="/delete" class="nav-btn" style="background:rgb(230, 13, 13);">Delete Data</a>
</nav>

<h1>Migration Game Dashboard</h1>

<div class="card">
    <form method="GET" class="inline">
        <label>Filter by Year:</label>
        <select name="year" onchange="this.form.submit()">
            {% for y in years %}
                <option value="{{y}}" {% if selected_year == y %}selected{% endif %}>{{y}}</option>
            {% endfor %}
        </select>
    </form>

    <form method="GET" class="inline">
        <input type="hidden" name="year" value="{{selected_year}}">
        <label>Filter by Category:</label>
        <select name="category" onchange="this.form.submit()">
            {% for c in categories %}
                <option value="{{c}}" {% if selected_category == c %}selected{% endif %}>{{c}}</option>
            {% endfor %}
        </select>
    </form>
</div>

{% if empty %}
    <p>No data recorded yet for this filter.</p>
{% else %}

<div class="card">
    <h2>Overview</h2>
    <p><strong>Total entries:</strong> {{ total }}</p>
    <p><strong>Overall accuracy:</strong> {{ accuracy }}%</p>
</div>

<div class="card">
    <h2>All Entries (Grouped by participant)</h2>

    {% for g in grouped_entries %}
        <div class="card" style="margin-bottom:12px;">
            <h3>Participant: {{ g.participant_id }}</h3>
            <table>
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Year</th>
                        <th>Category</th>
                        <th>Difficulty</th>
                        <th>Result</th>
                    </tr>
                </thead>
                <tbody>
                {% for row in g.rows %}
                    <tr>
                        <td>{{ row.timestamp }}</td>
                        <td>{{ row.year }}</td>
                        <td>{{ row.category }}</td>
                        <td>{{ row.difficulty }}</td>
                        <td>
                            {% if row.correct_text == 'Correct' %}
                                <span class="correct">Correct</span>
                            {% else %}
                                <span class="incorrect">Incorrect</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    {% endfor %}

{% endif %}

</body>
</html>
